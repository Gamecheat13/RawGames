;========== Cutscene Stubs ==========
(script stub void x10
	(print "Joe's Cool Cinematic")
	(fade_out 0 0 0 0)
	(sleep 900)
	)

(script stub void halo_setup
	(print "Joe's Cool Cinematic")
	)

(script stub void x20
	(print "Joe's Cool Cinematic")
	)

(script stub void x20_post
	(print "Joe's Cool Cinematic")
	)

(script stub void x30
	(print "Joe's Cool Cinematic")
	)

;========== Global Variables ==========
;Every global variable used in the mission script

	(global short global_random 0)
	(global short global_random_rumble 0)
	(global short global_random_bridge 0)

	(global short global_bridge_scale 0)
	(global boolean global_first_run true)

	(global long delay_blink (* 30 3))
	(global long delay_dawdle (* 30 10))
	(global long delay_tutorial (* 30 15))
	(global long delay_prompt (* 30 10))
	(global long delay_witness (* 30 5))
	(global long delay_wait (* 30 10))
	(global long delay_late (* 30 45))
	(global long delay_lost (* 30 60))

	(global boolean test_looking_red false)
	(global boolean test_looking_yellow false)

	(global short test_looking_cycle 0)
	(global boolean test_center_panel false)
	(global boolean test_left_panel false)
	(global boolean test_right_panel false)
	(global boolean test_up_panel false)
	(global boolean test_down_panel false)

	(global boolean test_looking_choose false)
	(global boolean test_bridge_active false)
	(global boolean mark_bridge_cutscene false)
	(global boolean mark_bridge_cutscene_start false)

	(global boolean global_rumble false)
	(global boolean global_intercom false)
	(global long delay_rumble_short (* 30 15))
	(global long delay_rumble_medium (* 30 30))
	(global long delay_rumble_long (* 30 60))

	(global boolean mark_bsp0 false)
	(global boolean mark_bsp1 false)
	(global boolean mark_bsp2 false)
	(global boolean mark_bsp3 false)
	(global boolean mark_bsp4 false)
	(global boolean mark_bsp5 false)

	(global boolean mark_fast_setup false)

	(global boolean mark_tutorial_setup false)
	(global boolean mark_tutorial_introduction false)
	(global boolean mark_tutorial_looking false)
	(global boolean mark_tutorial_hud_health false)
	(global boolean mark_tutorial_action false)
	(global boolean mark_tutorial_moving_1 false)
	(global boolean mark_tutorial_looking_targeted false)
	(global boolean mark_tutorial_looking_choose false)
	(global boolean mark_tutorial_moving_2 false)
	(global boolean mark_tutorial_hud_shield false)
	(global boolean mark_tutorial_asst_kill false)
	(global boolean mark_tutorial_moving_jump false)
	(global boolean mark_tutorial_moving_crouch false)
	(global boolean mark_tutorial_light false)
	(global boolean mark_cryo_explosion false)
	(global boolean mark_containment_1 false)
	(global boolean mark_weapon false)
	(global boolean mark_shoot false)
	(global boolean mark_lifepod_blasts false)
	(global boolean mark_launch_1 false)
	(global boolean mark_launch_3 false)
	(global boolean global_meg_egg false)

	(global boolean test_moving_jump false)
	(global boolean test_moving_crouch false)
	(global boolean test_light false)
	(global boolean test_motiontracker false)
	(global boolean test_lifepod_blasts false)
	(global boolean global_test_melee false)

	(global short bridge_living_count 0)

;========== Music Scripts ==========
(global boolean play_music_a10_01 false)
(global boolean play_music_a10_01_alt false)
(global boolean play_music_a10_02 false)
(global boolean play_music_a10_02_alt false)
(global boolean play_music_a10_03 false)
(global boolean play_music_a10_03_alt false)
(global boolean play_music_a10_04 false)
(global boolean play_music_a10_04_alt false)
(global boolean play_music_a10_05 false)
(global boolean play_music_a10_05_alt false)
(global boolean play_music_a10_06 false)
(global boolean play_music_a10_06_alt false)
(global boolean play_music_a10_07 false)
(global boolean play_music_a10_07_alt false)

(script dormant music_a10_01
	(sleep_until play_music_a10_01 1)
	(sound_looping_start "levels\a10\music\a10_01" none 1)
	(print "levels\a10\music\a10_01")

	(sleep_until (or play_music_a10_01_alt
				  (not play_music_a10_01)) 1 global_delay_music)
	(if play_music_a10_01_alt (begin (sound_looping_set_alternate "levels\a10\music\a10_01" 1)
							   (sleep_until (not play_music_a10_01) 1 global_delay_music)
							   (set play_music_a10_01_alt false)
							   ))
	(set play_music_a10_01 false)
	(sound_looping_stop "levels\a10\music\a10_01")
	)

(script dormant music_a10_03
	(sleep_until play_music_a10_03 1)
	(sound_looping_start "levels\a10\music\a10_03" none 1)
	(print "levels\a10\music\a10_03")

	(sleep_until (or play_music_a10_03_alt
				  (not play_music_a10_03)) 1 global_delay_music)
	(if play_music_a10_03_alt (begin (sound_looping_set_alternate "levels\a10\music\a10_03" 1)
							   (sleep_until (not play_music_a10_03) 1 global_delay_music)
							   (set play_music_a10_03_alt false)
							   ))
	(set play_music_a10_03 false)
	(sound_looping_stop "levels\a10\music\a10_03")
	)

(script dormant music_a10_04
	(sleep_until play_music_a10_04 1)
	(sound_looping_start "levels\a10\music\a10_04" none 1)
	(print "levels\a10\music\a10_03")

	(sleep_until (or play_music_a10_04_alt
				  (not play_music_a10_04)) 1 global_delay_music)
	(if play_music_a10_04_alt (begin (sound_looping_set_alternate "levels\a10\music\a10_04" 1)
							   (sleep_until (not play_music_a10_04) 1 global_delay_music)
							   (set play_music_a10_04_alt false)
							   ))
	(set play_music_a10_04 false)
	(sound_looping_stop "levels\a10\music\a10_04")
	)

(script dormant music_a10_05
	(sleep_until play_music_a10_05 1)
	(sound_looping_start "levels\a10\music\a10_05" none 1)
	(print "levels\a10\music\a10_05")

	(sleep_until (or play_music_a10_05_alt
				  (not play_music_a10_05)) 1 global_delay_music)
	(if play_music_a10_05_alt (begin (sound_looping_set_alternate "levels\a10\music\a10_05" 1)
							   (sleep_until (not play_music_a10_05) 1 global_delay_music)
							   (set play_music_a10_05_alt false)
							   ))
	(set play_music_a10_05 false)
	(sound_looping_stop "levels\a10\music\a10_05")
	)

(script dormant music_a10_06
	(sleep_until play_music_a10_06 1)
	(sound_looping_start "levels\a10\music\a10_06" none 1)
	(print "levels\a10\music\a10_06")
	(sleep_until (or play_music_a10_06_alt
				  (not play_music_a10_06)) 1 global_delay_music)
	(if play_music_a10_06_alt (begin (sound_looping_set_alternate "levels\a10\music\a10_06" 1)
							   (sleep_until (not play_music_a10_06) 1 global_delay_music)
							   (set play_music_a10_06_alt false)
							   ))
	(set play_music_a10_06 false)
	(sound_looping_stop "levels\a10\music\a10_06")
	)

(script dormant music_a10_07
	(sleep_until play_music_a10_07 1)
	(sound_looping_start "levels\a10\music\a10_07" none 1)
	(print "levels\a10\music\a10_07")
	(sleep_until (or play_music_a10_07_alt
				  (not play_music_a10_07)) 1 global_delay_music)
	(if play_music_a10_07_alt (begin (sound_looping_set_alternate "levels\a10\music\a10_07" 1)
							   (sleep_until (not play_music_a10_07) 1 global_delay_music)
							   (set play_music_a10_07_alt false)
							   ))
	(set play_music_a10_07 false)
	(sound_looping_stop "levels\a10\music\a10_07")
	)

(script dormant music_a10

	(wake music_a10_01)
	(wake music_a10_03)
	(wake music_a10_04)
	(wake music_a10_05)
	(wake music_a10_06)
	(wake music_a10_07)
	
	(sleep_until play_music_a10_02 1)
	(sound_looping_start "levels\a10\music\a10_02" none 1)
	)

;========== Flavor Scripts ==========
(script dormant dialog_flavor_cortana
	(sound_impulse_start sound\dialog\a10\A10_flavor_010_Cortana none .5)
	(sleep -1)
	(sound_impulse_start sound\dialog\a10\A10_flavor_020_Cortana none .5)
	(sleep -1)
	(sound_impulse_start sound\dialog\a10\A10_flavor_030_Cortana none .5)
	(sleep -1)
	(sound_impulse_start sound\dialog\a10\A10_flavor_040_Cortana none .5)
	(sleep -1)
	(sound_impulse_start sound\dialog\a10\A10_flavor_050_Cortana none .5)
	(sleep -1)
	(sound_impulse_start sound\dialog\a10\A10_flavor_060_Cortana none .5)
	(sleep -1)
	(sound_impulse_start sound\dialog\a10\A10_flavor_070_Cortana none .5)
	(sleep -1)
	(sound_impulse_start sound\dialog\a10\A10_flavor_080_Cortana none .5)
	(sleep -1)
	(sound_impulse_start sound\dialog\a10\A10_flavor_090_Cortana none .5)
	(sleep -1)
	(sound_impulse_start sound\dialog\a10\A10_flavor_100_Cortana none .5)
	(sleep -1)
	(sound_impulse_start sound\dialog\a10\A10_flavor_040_Cortana none .5)
	(sleep -1)
	(sound_impulse_start sound\dialog\a10\A10_flavor_050_Cortana none .5)
	(sleep -1)
	(sound_impulse_start sound\dialog\a10\A10_flavor_060_Cortana none .5)
	(sleep -1)
	(sound_impulse_start sound\dialog\a10\A10_flavor_070_Cortana none .5)
	(sleep -1)
	(sound_impulse_start sound\dialog\a10\A10_flavor_080_Cortana none .5)
	(sleep -1)
	(sound_impulse_start sound\dialog\a10\A10_flavor_090_Cortana none .5)
	(sleep -1)
	(sound_impulse_start sound\dialog\a10\A10_flavor_100_Cortana none .5)
	)

;Lifeboat	(sound_impulse_start sound\dialog\a10\A10_flavor_280_Cortana none .5)

(script continuous dialog_flavor_captain
	(sleep -1)
	(print "Blah blah blah")
	(sound_impulse_start sound\dialog\a10\A10_flavor_110_CaptKeyes none .5)
	(sleep -1)
	(print "Blah blah blah")
	(sound_impulse_start sound\dialog\a10\A10_flavor_120_CaptKeyes none .5)
	(sleep -1)
	(print "Blah blah blah")
	(sound_impulse_start sound\dialog\a10\A10_flavor_130_CaptKeyes none .5)
	(sleep -1)
	(print "Blah blah blah")
	(sound_impulse_start sound\dialog\a10\A10_flavor_140_CaptKeyes none .5)
	(sleep -1)
	(print "Blah blah blah")
	(sound_impulse_start sound\dialog\a10\A10_flavor_150_CaptKeyes none .5)
	(sleep -1)
	(print "Blah blah blah")
	(sound_impulse_start sound\dialog\a10\A10_flavor_160_CaptKeyes none .5)
	(sleep -1)
	(print "Blah blah blah")
	(sound_impulse_start sound\dialog\a10\A10_flavor_170_CaptKeyes none .5)
;	(sleep -1)
;	(print "Blah blah blah")
;	(sound_impulse_start sound\dialog\a10\A10_flavor_180_CaptKeyes none .5)
;	(sleep -1)
;	(print "Blah blah blah")
;	(sound_impulse_start sound\dialog\a10\A10_flavor_190_CaptKeyes none .5)
;	(sleep -1)
;	(print "Blah blah blah")
;	(sound_impulse_start sound\dialog\a10\A10_flavor_200_CaptKeyes none .5)
	(sleep -1)
	(print "Blah blah blah")
	(sound_impulse_start sound\dialog\a10\A10_flavor_210_CaptKeyes none .5)
	)

(script continuous flavor_intercom
	(sleep_until global_intercom 1)
	(if (and global_intercom (not test_bridge_active)) (if mark_bridge_cutscene (wake dialog_flavor_captain) (wake dialog_flavor_cortana)))
	(sleep (random_range (* 30 60) (* 30 120)))
	(if (not global_rumble) (sleep (random_range (* 30 30) (* 30 60))))
	)

(script continuous flavor_rumble
	(sleep (* (random_range (* 30 45) (* 30 75)) (+ .25 (max 0 (* .125 (- 6 (structure_bsp_index)))))))

	(cond (test_bridge_active (sleep 120))
		 ((not global_rumble) (sleep 120))
		 ((= (structure_bsp_index) 0) (begin (player_effect_rumble)
									  (player_effect_start (real_random_range .55 .75) 1)
									  (sleep 30)
									  (player_effect_stop (real_random_range .75	1.25))))
		 ((= (structure_bsp_index) 1) (begin (player_effect_rumble)
									  (player_effect_start (real_random_range .65 .85) 1)
									  (sleep 30)
									  (player_effect_stop (real_random_range 1 1.5))))
		 ((= (structure_bsp_index) 2) (begin (sound_impulse_start sound\sfx\ambience\a10\pillarhits none (real_random_range .4 .7))
									  (player_effect_rumble)
									  (player_effect_start (real_random_range .85 1.05) 1)
									  (sleep 30)
									  (player_effect_stop (real_random_range 1.5 2.5))))
		 ((= (structure_bsp_index) 3) (begin (sound_impulse_start sound\sfx\ambience\a10\pillarhits none (real_random_range .5 .8))
									  (player_effect_rumble)
									  (player_effect_start (real_random_range .95 1.15) 1)
									  (sleep 30)
									  (player_effect_stop (real_random_range 2 3.5))))
		 ((= (structure_bsp_index) 4) (begin (sound_impulse_start sound\sfx\ambience\a10\pillarhits none (real_random_range .6 .9))
									  (player_effect_impact)
									  (player_effect_start (real_random_range .6	.8) 1)
									  (sleep 30)
									  (player_effect_stop (real_random_range .75	1.25))))
		 ((= (structure_bsp_index) 5) (begin (sound_impulse_start sound\sfx\ambience\a10\pillarhits none (real_random_range .7 1))
									  (player_effect_impact)
									  (player_effect_start (real_random_range .85 1.05) 1)
									  (sleep 30)
									  (player_effect_stop (real_random_range 1 1.5))))
		 ((= (structure_bsp_index) 6) (begin (sound_impulse_start sound\sfx\ambience\a10\pillarhits none (real_random_range .8 1))
									  (player_effect_impact)
									  (player_effect_start (real_random_range .95 1.15) 1)
									  (sleep 30)
									  (player_effect_stop (real_random_range 2 3))))
		)
	)

(script dormant mission_bsp
	(sleep_until (< 0 (structure_bsp_index)) 1)
	(ai_free first_contact)
	(device_set_position bsp0_door 0)
	(sleep_until (= 0 (device_get_position bsp0_door)) 1)
	(device_set_power bsp0_door 0)
	(set mark_bsp0 true)

	(sleep_until (< 1 (structure_bsp_index)) 1)
	(device_set_position_immediate bsp1_door 0)
	(device_set_power bsp1_door 0)
	(set mark_bsp1 true)

	(sleep_until (< 2 (structure_bsp_index)) 1)
	(device_set_position_immediate bsp2_door 0)
	(device_set_power bsp2_door 0)
	(set mark_bsp2 true)

	(sleep_until (< 3 (structure_bsp_index)) 1)
	(device_set_position_immediate bsp3_door 0)
	(device_set_power bsp3_door 0)
	(set mark_bsp3 true)

	(sleep_until (< 4 (structure_bsp_index)) 1)
	(device_set_position_immediate tunnel_door_1 0)
	(device_set_position_immediate tunnel_door_2 0)
	(device_set_power tunnel_door_1 0)
	(device_set_power tunnel_door_2 0)
	(set mark_bsp4 true)

	(sleep_until (< 5 (structure_bsp_index)) 1)
	(device_set_position_immediate bsp5_door .1)
	(device_set_power bsp5_door 0)
	(set mark_bsp5 true)
	)

(script dormant title_training
	(cinematic_show_letterbox 1)
	(show_hud 0)
	(sleep 30)
	(cinematic_set_title training)
	(sleep 150)
	(show_hud 1)
	(cinematic_show_letterbox 0)
	)

(script dormant title_bridge
	(cinematic_show_letterbox 1)
	(show_hud 0)
	(sleep 30)
	(cinematic_set_title bridge)
	(sleep 150)
	(show_hud 1)
	(cinematic_show_letterbox 0)
	)

(script dormant title_escape
	(cinematic_show_letterbox 1)
	(show_hud 0)
	(sleep 30)
	(cinematic_set_title escape)
	(sleep 150)
	(show_hud 1)
	(cinematic_show_letterbox 0)
	)

(script startup cont_thing
	(if (and (not (game_is_cooperative)) (= (game_difficulty_get) impossible)) (sleep_until (volume_test_objects meg_egg (players)) delay_dawdle))
	(if (and (not (game_is_cooperative)) (= (game_difficulty_get) impossible)) (set global_meg_egg true)) 
	)
